window.__require=function t(e,i,a){function o(n,r){if(!i[n]){if(!e[n]){var m=n.split("/");if(m=m[m.length-1],!e[m]){var l="function"==typeof __require&&__require;if(!r&&l)return l(m,!0);if(s)return s(m,!0);throw new Error("Cannot find module '"+n+"'")}n=m}var h=i[n]={exports:{}};e[n][0].call(h.exports,function(t){return o(e[n][1][t]||t)},h,h.exports,t,e,i,a)}return i[n].exports}for(var s="function"==typeof __require&&__require,n=0;n<a.length;n++)o(a[n]);return o}({CoinControl:[function(t,e,i){"use strict";cc._RF.push(e,"5e92aalKeRCl4+doyCuCPbC","CoinControl");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../script/framework/utils/FrameworkEvent"),r=t("../../../script/entity/BaseControl"),m=t("../../../script/framework/utils/MathUtils"),l=cc._decorator,h=l.ccclass,c=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.coinnum=0,e.actionEndFlag=!1,e.cointime=3,e.getFlag=!1,e.collider=null,e}return o(e,t),e.prototype.onLoad=function(){this.collider=this.node.getComponent(cc.PolygonCollider),this.collider.enabled=!1},e.prototype.start=function(){},e.prototype.init=function(t,e){this.collider.enabled=!1,this.coinnum=t,this.getFlag=!1,this.actionEndFlag=!1,this.cointime=3,this.setPosition(e),this.playTween()},e.prototype.setPosition=function(t){this.node.setPosition(new cc.Vec2(t.x-375,t.y-667))},e.prototype.autoGetCoin=function(){this.getFlag||(moosnow.event.sendEventImmediately(n.default.LEVEL_COIN_CHANGE,{coinnum:this.coinnum}),this.clearCoins())},e.prototype.clearCoins=function(){this.unschedule(this.autoGetCoin),moosnow.event.sendEventImmediately(n.default.RECOVERY_COINS,{enemy:this.node})},e.prototype.playTween=function(){var t=m.default.randomNumBoth(0,200);m.default.randomNumBoth(0,1)&&(t=0-t);var e=m.default.randomNumBoth(0,100);m.default.randomNumBoth(0,1)&&(e=0-e);var i=this.node.y+e;i<Lite.myGame.map.map_Down-667?i=Lite.myGame.map.map_Down-667:i>Lite.myGame.map.map_Up-667&&(i=Lite.myGame.map.map_Up-667);var a=this.node.x+t;a<Lite.myGame.map.map_left-280?a=Lite.myGame.map.map_left-280:a>Lite.myGame.map.map_right-425&&(a=Lite.myGame.map.map_right-425);var o=m.default.randomNumBoth(100,150),s=cc.callFunc(function(){this.actionEndFlag=!0},this),n=cc.callFunc(function(){(a+=t/2)<Lite.myGame.map.map_left-280?a=Lite.myGame.map.map_left-280:a>Lite.myGame.map.map_right-425&&(a=Lite.myGame.map.map_right-425),(i+=e/2)<Lite.myGame.map.map_Down-667?i=Lite.myGame.map.map_Down-667:i>Lite.myGame.map.map_Up-667&&(i=Lite.myGame.map.map_Up-667);var n=cc.sequence(cc.jumpTo(.5,a,i,o/2,1),s);this.node.runAction(n)},this),r=cc.sequence(cc.jumpTo(1,a,i,o,1),n);this.node.runAction(r)},e.prototype.update=function(){this.actionEndFlag&&(this.actionEndFlag=!1,this.collider.enabled=!0,this.scheduleOnce(this.autoGetCoin,this.cointime))},s([h],e)}(r.default));i.default=c,cc._RF.pop()},{"../../../script/entity/BaseControl":void 0,"../../../script/framework/utils/FrameworkEvent":void 0,"../../../script/framework/utils/MathUtils":void 0}],ColliderListener:[function(t,e,i){"use strict";cc._RF.push(e,"4925a1p4g1AaKMA+pj6e4es","ColliderListener");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../script/enum/PLAYER_STATE"),r=t("../../../script/enum/MASTER_STATE"),m=t("../../../script/framework/utils/FrameworkEvent"),l=t("./MasterControl"),h=t("./CoinControl"),c=t("../../../script/enum/MASTER_TYPE"),_=cc._decorator,p=_.ccclass,d=(_.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.m_checkFlag=!0,e.p_checkFlag=!0,e.c_manager=null,e}return o(e,t),e.prototype.onLoad=function(){this.c_manager=cc.director.getCollisionManager(),this.c_manager.enabled=!0,this.addListener()},e.prototype.setCollisionManager=function(t){this.c_manager.enabled=t},e.prototype.setTag=function(t){for(var e=this.node.getComponents(cc.PolygonCollider),i=0;i<e.length;i++)e[i].tag+=t},e.prototype.onCollisionEnter=function(t,e){if(7777==t.tag&&e.tag==Lite.myGame.player.pleyerTag){var i=t.node.getComponent(h.default);moosnow.event.sendEventImmediately(m.default.LEVEL_COIN_CHANGE,{coinnum:i.coinnum}),Lite.audio.playerCoin(),i.clearCoins()}},e.prototype.onCollisionStay=function(t,e){if(Lite.myGame.player.playerState==n.PLAYER_STATE.E_State_Attack&&Lite.myGame.player.playerHurtFlag&&this.m_checkFlag&&t.tag==Lite.myGame.player.attackTag&&(this.m_checkFlag=!1,moosnow.event.sendEventImmediately(m.default.MASTER_HIT,{masterNum:e.tag})),e.tag==Lite.myGame.player.pleyerTag){var i=t.node.getComponent(l.default),a=t.node.x,o=t.node.y;if(i){if(i.m_HurtFlag)if(i.m_HurtFlag=!1,i.masterType==c.MASTER_TYPE.Yellowboss)if(1==i.m_skill_type){var s=0;this.schedule(function(){7==++s?moosnow.event.sendEventImmediately(m.default.CHANGE_SKILL_TYPE,{}):6==s?moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv,m_pos_y:o,m_pos_x:a,masterType:i.masterType,m_skill_type:1,end_flag:!0}):moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv,m_pos_y:o,m_pos_x:a,masterType:i.masterType,m_skill_type:1,end_flag:!1})},.2,6,.2)}else 2==i.m_skill_type&&moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv*6,m_pos_y:o,m_pos_x:a,masterType:i.masterType});else if(i.masterType==c.MASTER_TYPE.Redboss){if(1==i.m_skill_type){var h=0;this.schedule(function(){3==++h?moosnow.event.sendEventImmediately(m.default.CHANGE_SKILL_TYPE,{}):2==h?moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv*4,m_pos_y:o,m_pos_x:a,masterType:i.masterType,m_skill_type:1,end_flag:!0}):moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv*4,m_pos_y:o,m_pos_x:a,masterType:i.masterType,m_skill_type:1,end_flag:!1})},.2,2,.2)}else if(2==i.m_skill_type){var _=0;this.schedule(function(){4==++_?moosnow.event.sendEventImmediately(m.default.CHANGE_SKILL_TYPE,{}):3==_?moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv*4,m_pos_y:o,m_pos_x:a,masterType:i.masterType,m_skill_type:2,end_flag:!0}):moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv*2,m_pos_y:o,m_pos_x:a,masterType:i.masterType,m_skill_type:2,end_flag:!1})},.35,3,.3)}}else i.masterType==c.MASTER_TYPE.Bigman?(moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv,m_pos_y:o,m_pos_x:a,masterType:i.masterType,shake:!0,master:i}),i.masterState==r.MASTER_STATE.E_State_Attack&&this.scheduleOnce(function(){i.m_HurtFlag=!0},.2)):moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv,m_pos_y:o,m_pos_x:a,masterType:i.masterType})}else{if(8001!=t.tag)return;i=t.node.parent.parent.parent.parent.parent.parent.parent.getComponent(l.default),a=i.node.x,o=i.node.y,i.m_HurtFlag&&(i.m_HurtFlag=!1,moosnow.event.sendEventImmediately(m.default.PLAYER_HIT,{damage:i.m_Damage*i.m_Damage_Lv,m_pos_y:o,m_pos_x:a,masterType:i.masterType}))}}},e.prototype.onCollisionExit=function(){},e.prototype.addListener=function(){moosnow.event.addListener(m.default.CAN_HIT,this,this.setCheckFlag)},e.prototype.removeListener=function(){moosnow.event.removeListener(m.default.CAN_HIT,this)},e.prototype.setCheckFlag=function(t){this.m_checkFlag=t.checkFlag},e.prototype.onDisable=function(){this.removeListener()},e.prototype.update=function(){},s([p],e)}(cc.Component));i.default=d,cc._RF.pop()},{"../../../script/enum/MASTER_STATE":void 0,"../../../script/enum/MASTER_TYPE":void 0,"../../../script/enum/PLAYER_STATE":void 0,"../../../script/framework/utils/FrameworkEvent":void 0,"./CoinControl":"CoinControl","./MasterControl":"MasterControl"}],GuidanceControl:[function(t,e,i){"use strict";cc._RF.push(e,"7a811eZp59KdaeP8G0ZS7w7","GuidanceControl");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../script/entity/BaseControl"),r=cc._decorator,m=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hitNum=null,e}return o(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.init=function(){},e.prototype.update=function(){},s([l(cc.Label)],e.prototype,"hitNum",void 0),s([m],e)}(n.default);i.default=h,cc._RF.pop()},{"../../../script/entity/BaseControl":void 0}],HitNumControl:[function(t,e,i){"use strict";cc._RF.push(e,"46002SV18lEQLaxy+hPSPqy","HitNumControl");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../script/framework/utils/FrameworkEvent"),r=t("../../../script/entity/BaseControl"),m=t("../../../script/framework/utils/MathUtils"),l=cc._decorator,h=l.ccclass,c=l.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hitNum=null,e.x_point=0,e.scale=1.5,e}return o(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.init=function(t,e,i,a){a||(a=0),this.node.zIndex=1e4,this.node.opacity=255;var o=-667,s=-255;0==a&&(o=0,s=0);var r=this.node.getChildByName("cri");r&&(r.active=!1,this.node.setScale(1,1)),null==i?(this.node.setPosition(new cc.Vec2(e.position.x+s,e.position.y+150+o)),this.hitNum.string="-"+t.toString(),this.node.color=new cc.Color(255,255,255)):(this.node.setPosition(new cc.Vec2(e.position.x+s,e.position.y+150+o)),this.hitNum.string="-"+t.toString(),this.node.color=new cc.Color(255,255,255),i&&(this.node.color=new cc.Color(255,231,0),r&&(r.active=!0,this.node.setScale(1.2,1.2))));var l=cc.callFunc(function(){a>0&&moosnow.event.sendEventImmediately(n.default.RECOVERY_HITNUM,{enemy:this.node,masterNum:a})},this),h=cc.callFunc(function(){var t=cc.fadeOut(1),e=cc.sequence(t,l);this.node.runAction(e)},this),c=cc.moveTo(.5,new cc.Vec2(this.node.x+this.x_point+50,this.node.y+m.default.randomNumBoth(80,120))),_=cc.sequence(c,h);this.node.runAction(_)},e.prototype.update=function(){},s([c(cc.Label)],e.prototype,"hitNum",void 0),s([h],e)}(r.default);i.default=_,cc._RF.pop()},{"../../../script/entity/BaseControl":void 0,"../../../script/framework/utils/FrameworkEvent":void 0,"../../../script/framework/utils/MathUtils":void 0}],JoyStick:[function(t,e,i){"use strict";cc._RF.push(e,"a6803m1JI9C0qU/KdXbWH0k","JoyStick");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../script/framework/utils/FrameworkEvent"),r=t("../../../script/enum/PLAYER_STATE"),m=t("../../../script/enum/MASTER_TYPE"),l=cc._decorator,h=l.ccclass,c=l.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.joyStickBtn=null,e.joyStickPanel=null,e.dir=null,e.maxSpeed=7,e.cameraMoveFlag=!0,e.leftDis=375,e.rightDis=375,e.stopPosMin=null,e.stopPosMax=null,e.touchUpFlag=!1,e.defaultPoint=null,e}return o(e,t),e.prototype.onLoad=function(){this.dir=cc.v3(0,0,0),this.defaultPoint=this.node.position,this.addListener()},e.prototype.start=function(){},e.prototype.init=function(){this.leftDis=375,this.rightDis=375,this.stopPosMin=null,this.stopPosMax=null,this.dir=cc.v3(0,0,0)},e.prototype.addListener=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this),moosnow.event.addListener(n.default.PLAYER_CAN_MOVE,this,this.clearAirWall),moosnow.event.addListener(n.default.GAME_STATE_START,this,this.init),moosnow.event.addListener(n.default.TOUCH_DOWN,this,this.onTouchDown),moosnow.event.addListener(n.default.TOUCH_MOVE,this,this.onTouchMove),moosnow.event.addListener(n.default.TOUCH_UP,this,this.onTouchUp),moosnow.event.addListener(n.default.TOUCH_CANCEL,this,this.onTouchCancel)},e.prototype.removeListener=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this),moosnow.event.removeListener(n.default.PLAYER_CAN_MOVE,this),moosnow.event.removeListener(n.default.GAME_STATE_START,this),moosnow.event.removeListener(n.default.TOUCH_DOWN,this),moosnow.event.removeListener(n.default.TOUCH_MOVE,this)},e.prototype.onTouchStart=function(t){if(Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Death&&Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Skill){var e=this.node.convertToNodeSpaceAR(t.getLocation());this.joyStickBtn.setPosition(e)}},e.prototype.onTouchDown=function(){this.touchUpFlag||(this.touchUpFlag=!0)},e.prototype.onTouchUp=function(){Lite.myGame.startFlag&&(this.touchUpFlag&&(this.touchUpFlag=!1),this.joyStickBtn.setPosition(cc.v2(0,0)),this.joyStickPanel.setPosition(this.defaultPoint),Lite.myGame.player.playerState==r.PLAYER_STATE.E_State_Walk&&Lite.myGame.player.setPlayerState(r.PLAYER_STATE.E_State_Idle))},e.prototype.onTouchMove=function(t){if(Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Death&&Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Hit&&Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Skill&&Lite.myGame.startFlag){if(this.touchUpFlag){this.touchUpFlag=!1;var e=t.touch.getLocation(),i=this.node.parent.convertToNodeSpaceAR(e);this.joyStickPanel.setPosition(i)}var a=t.getDelta();this.joyStickBtn.setPosition(this.joyStickBtn.position.add(a)),this.dir=this.joyStickBtn.position.normalize(),Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Attack&&(this.dir.x>0?Lite.myGame.player.setPlayerDirection(0):Lite.myGame.player.setPlayerDirection(1)),0!=this.dir.y&&Lite.myGame.player.updatezIndex(),Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Walk&&Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Attack&&Lite.myGame.player.setPlayerState(r.PLAYER_STATE.E_State_Walk)}},e.prototype.onTouchEnd=function(){this.joyStickBtn.setPosition(cc.v2(0,0)),this.joyStickPanel.setPosition(this.defaultPoint),Lite.myGame.player.playerState==r.PLAYER_STATE.E_State_Walk&&Lite.myGame.player.setPlayerState(r.PLAYER_STATE.E_State_Idle)},e.prototype.onTouchCancel=function(){this.joyStickBtn.setPosition(cc.v2(0,0)),this.joyStickPanel.setPosition(this.defaultPoint),Lite.myGame.player.playerState==r.PLAYER_STATE.E_State_Walk&&Lite.myGame.player.setPlayerState(r.PLAYER_STATE.E_State_Idle)},e.prototype.clearAirWall=function(){this.stopPosMax=new cc.Vec2(Lite.myGame.player.node.x+1e4,Lite.myGame.player.node.y),this.rightDis=375,Lite.myGame.cameraControl.rightDis=this.rightDis,this.scheduleOnce(function(){if(Lite.myGame.player.node.position.x>this.leftDis+375){var t=Math.abs(Lite.myGame.player.node.position.x-375);Lite.myGame.cameraControl.movemCamera(t)}},.5)},e.prototype.checkLockRoad=function(){var t=0,e=Lite.myGame.map.getTilePos(new cc.Vec2(Lite.myGame.player.node.x,Lite.myGame.player.node.y)),i=e.clone();this.joyStickBtn.position.x<0?e.x-=1:this.joyStickBtn.position.x>0&&(e.x+=1),this.joyStickBtn.position.y<0?e.y+=1:this.joyStickBtn.position.y>0&&(e.y-=1);var a=Lite.myGame.map.tiledMap.getMapSize();return(e.x<0||e.x>=a.width)&&(t=1),null!=this.stopPosMin&&null!=this.stopPosMax&&(e.x<this.stopPosMin.x||e.x>=this.stopPosMax.x)&&(t=1),(e.y<0||e.y>=a.height)&&0==t&&(t=2),Lite.myGame.map.batch<=Lite.myGame.map.batchTotal&&Lite.myGame.map.checkPointFlag&&Lite.myGame.map.refreshPoint==e.x&&(Lite.myGame.map.checkPointFlag=!1,Lite.myGame.player.node.position.x-375<375?this.leftDis=375:this.leftDis=Lite.myGame.player.node.position.x-375,Lite.myGame.map.mapSize.width-Lite.myGame.player.node.position.x-375<375?this.rightDis=375:this.rightDis=Lite.myGame.map.mapSize.width-Lite.myGame.player.node.position.x-375,Lite.myGame.cameraControl.leftDis=this.leftDis,Lite.myGame.cameraControl.rightDis=this.rightDis,Lite.myGame.map.map_left=Lite.myGame.player.node.x-750,Lite.myGame.map.map_right=Lite.myGame.player.node.x+750,this.stopPosMin=Lite.myGame.map.getTilePos(new cc.Vec2(Lite.myGame.player.node.x-750,Lite.myGame.player.node.y)),this.stopPosMax=Lite.myGame.map.getTilePos(new cc.Vec2(Lite.myGame.player.node.x+750,Lite.myGame.player.node.y)),moosnow.event.sendEventImmediately(n.default.CREATE_MASTER,{masterNum:4,masterType:m.MASTER_TYPE.Putong})),0==t?t=Lite.myGame.map.floorLayer.getTileGIDAt(e.x,e.y)?0:Lite.myGame.map.floorLayer.getTileGIDAt(e.x,i.y)?2:Lite.myGame.map.floorLayer.getTileGIDAt(i.x,e.y)?1:3:1==t?t=Lite.myGame.map.floorLayer.getTileGIDAt(i.x,e.y)?1:3:2==t&&(t=Lite.myGame.map.floorLayer.getTileGIDAt(e.x,i.y)?2:3),t},e.prototype.onDestroy=function(){this.removeListener()},e.prototype.update=function(){if(Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Hit&&Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Skill&&Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Death&&Lite.myGame.player.playerState!=r.PLAYER_STATE.E_State_Attack&&!Lite.myGame.map.showBuffFlag&&Lite.myGame.startFlag&&Lite.myGame.cameraControl.canMoveFlag){var t=this.joyStickBtn.position.mag(),e=t/(this.node.width/2);Lite.myGame.player.playerState==r.PLAYER_STATE.E_State_Idle&&t>0&&Lite.myGame.player.setPlayerState(r.PLAYER_STATE.E_State_Walk),e>1&&this.joyStickBtn.setPosition(this.joyStickBtn.position.div(e));var i=this.dir.mul(this.maxSpeed*e),a=this.checkLockRoad();if(a<3){1==a?i.x=0:2==a&&(i.y=0),Lite.myGame.player.node.setPosition(Lite.myGame.player.node.position.add(i));var o=Lite.myGame.map.mapSize.width-this.rightDis;if(Lite.myGame.player.node.position.x+i.x>this.leftDis&&Lite.myGame.player.node.position.x+i.x<o&&(this.cameraMoveFlag=!0,Lite.myGame.cameraControl.cameraMoveFlag=!0,1==Lite.myGame.guidancePro&&(Lite.myGame.guidancePro=2,moosnow.event.sendEventImmediately(n.default.GUIDANCE_NOVICE,{}))),Lite.myGame.cameraControl.cameraMoveFlag){var s=new cc.Vec3(i.x,0,0);Lite.myGame.cameraControl.mCamera&&(Lite.myGame.cameraControl.mCamera.node.position.x+s.x<=this.leftDis-375?(this.cameraMoveFlag=!1,Lite.myGame.cameraControl.cameraMoveFlag=!1,Lite.myGame.cameraControl.mCamera.node.setPosition(this.leftDis-375,0)):Lite.myGame.cameraControl.mCamera.node.position.x+s.x>=o-375?(this.cameraMoveFlag=!1,Lite.myGame.cameraControl.cameraMoveFlag=!1,Lite.myGame.cameraControl.mCamera.node.setPosition(o-375,0)):Lite.myGame.cameraControl.mCamera.node.setPosition(Lite.myGame.cameraControl.mCamera.node.position.add(s)))}}}},s([c(cc.Node)],e.prototype,"joyStickBtn",void 0),s([c(cc.Node)],e.prototype,"joyStickPanel",void 0),s([h],e)}(cc.Component);i.default=_,cc._RF.pop()},{"../../../script/enum/MASTER_TYPE":void 0,"../../../script/enum/PLAYER_STATE":void 0,"../../../script/framework/utils/FrameworkEvent":void 0}],MasterControl:[function(t,e,i){"use strict";cc._RF.push(e,"fdba5iSRZhLoYqJU+fSBmNz","MasterControl");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../script/framework/utils/FrameworkEvent"),r=t("../../../script/entity/BaseControl"),m=t("../../../script/enum/MASTER_SPINE"),l=t("../../../script/enum/MASTER_STATE"),h=t("./ColliderListener"),c=t("../../../script/enum/MASTER_TYPE"),_=t("../../../script/enum/MASTER_AI"),p=t("../../../script/enum/WEAPON"),d=t("../../../script/framework/utils/MathUtils"),y=t("../../../sheets/vo/MasterCfg"),u=cc._decorator,A=u.ccclass,S=u.property,E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.m_Life_Progress=null,e.aniFrameHit=null,e.aniFrameHitIce=null,e.aniFrameHitIron=null,e.masterName=null,e.shader=null,e.ske_com_master=null,e.masterState=l.MASTER_STATE.E_State_Idle,e.aniState=m.MASTER_SPINE.MOVE,e.ani=null,e.attackTime=2,e.masterNum=0,e.aniCompleteFlag=!0,e.collider=null,e.deathTime=1.5,e.aniFrame=null,e.aniFrameIce=null,e.aniFrameIron=null,e.hitnumPool=null,e.masterType=null,e.m_MoveFlag=!1,e.m_Ai_State=_.MASTER_AI.AI_State_Idle,e.m_AttackFlag=!1,e.m_AttackTime=0,e.m_AttackTimeMax=0,e.m_AttackDistanceMin=50,e.m_AttackDistanceMax=200,e.m_AttackDistanceRandom=0,e.m_IdleTime=2,e.m_IdleTimeDefault=1,e.m_putong_speed=2,e.m_HurtFlag=!1,e.m_direction=0,e.checkDistanceFlage=!1,e.m_movePoint=null,e.m_decision=0,e.m_decision_change_time=20,e.m_ref_time=2,e.bone=null,e.superArmor_all=!1,e.superArmor_attack=!1,e.warningFlag=!1,e.m_HP=200,e.m_HP_MAX=200,e.m_HP_Lv=1,e.m_Damage=3,e.m_Damage_Lv=1,e.m_Coin=0,e.hitFixedTime=0,e.hitFixedTimeMax=.5,e.hitFixedTimeIce=0,e.hitFixedTimeIceMax=3,e.m_attack_distance=200,e.poisonTime=0,e.poisonTimeMax=10,e.poisonDamageRate=50,e.m_Damage_Rate_Min=1,e.m_Damage_Rate_Max=1,e.m_skill_type=1,e.m_bump_distance=500,e.sp_state=null,e.sp_state_data=null,e}return o(e,t),e.prototype.onLoad=function(){this.masterNum=++Lite.myGame.masterNum,this.collider=this.node.getComponent(h.default),this.collider.setTag(this.masterNum),this.masterName.string=this.masterNum.toString(),this.ske_com_master=this.node.getComponent(sp.Skeleton),this.sp_state=this.ske_com_master.getState(),this.sp_state_data=this.sp_state.data,this.bone=this.ske_com_master.findBone("bone"),this.aniFrame=this.aniFrameHit.getComponent(cc.Animation),this.aniFrameHitIce&&(this.aniFrameIce=this.aniFrameHitIce.getComponent(cc.Animation)),this.aniFrameIron=this.aniFrameHitIron.getComponent(cc.Animation),this.masterName.node.active=!1},e.prototype.start=function(){},e.prototype.init=function(t,e,i,a,o){this.masterType=t,this.m_direction=e,this.m_Coin=o,this.masterAIReset(),this.setMasterAttributeByExcel(i,a),this.changeAniColor()},e.prototype.setPoint=function(){var t=0,e=0;this.m_direction%2==0?(t=0,e=100):(t=650,e=750);var i=Lite.myGame.cameraControl.mCamera.node.position.x+t,a=Lite.myGame.cameraControl.mCamera.node.position.x+e,o=Lite.myGame.map.map_Down,s=Lite.myGame.map.map_Up,n=new cc.Vec2(moosnow.Common.randomNumBoth(i,a),moosnow.Common.randomNumBoth(o,s));this.node.setPosition(n)},e.prototype.setMasterAttribute=function(t,e){this.m_HP_Lv=Math.floor(Lite.myGame.g_Level/10)+1,this.m_Damage_Lv=Math.floor(Lite.myGame.g_Level/10)+1,this.masterType==c.MASTER_TYPE.Putong?(this.m_HP_MAX=this.m_HP_MAX*this.m_HP_Lv,this.m_HP=Math.floor(this.m_HP_MAX*t/100),this.m_Damage=Math.floor(this.m_Damage*this.m_Damage_Lv*e/100),this.m_putong_speed=2,this.m_AttackDistanceMin=50,this.m_AttackDistanceMax=200,this.m_attack_distance=200,this.hitFixedTimeMax=.5,this.m_IdleTimeDefault=1,this.superArmor_all=!1,this.superArmor_attack=!1,this.node.setScale(new cc.Vec2(.8,.8)),this.shader.setScale(new cc.Vec2(.8,.8))):this.masterType==c.MASTER_TYPE.Black?(this.m_HP_MAX=this.m_HP_MAX*this.m_HP_Lv*4,this.m_HP=Math.floor(this.m_HP_MAX*t/100),this.m_Damage=Math.floor(this.m_Damage*this.m_Damage_Lv*2*e/100),this.m_putong_speed=2.2,this.m_AttackDistanceMin=80,this.m_AttackDistanceMax=250,this.m_attack_distance=250,this.hitFixedTimeMax=.5,this.m_IdleTimeDefault=1,this.superArmor_all=!1,this.superArmor_attack=!1,this.node.setScale(new cc.Vec2(.8,.8)),this.shader.setScale(new cc.Vec2(.8,.8))):this.masterType==c.MASTER_TYPE.Gangguan?(this.m_HP_MAX=this.m_HP_MAX*this.m_HP_Lv*6,this.m_HP=Math.floor(this.m_HP_MAX*t/100),this.m_Damage=Math.floor(this.m_Damage*this.m_Damage_Lv*4*e/100),this.m_putong_speed=2.4,this.m_AttackDistanceMin=150,this.m_AttackDistanceMax=300,this.m_attack_distance=300,this.hitFixedTimeMax=.5,this.m_IdleTimeDefault=1.5,this.superArmor_all=!1,this.superArmor_attack=!1,this.node.setScale(new cc.Vec2(.8,.8)),this.shader.setScale(new cc.Vec2(.8,.8))):this.masterType==c.MASTER_TYPE.Bigman?(this.m_HP_MAX=this.m_HP_MAX*this.m_HP_Lv*10,this.m_HP=Math.floor(this.m_HP_MAX*t/100),this.m_Damage=Math.floor(this.m_Damage*this.m_Damage_Lv*6*e/100),this.m_putong_speed=1,this.m_AttackDistanceMin=100,this.m_AttackDistanceMax=500,this.m_attack_distance=500,this.hitFixedTimeMax=.8,this.m_IdleTimeDefault=2,this.superArmor_all=!1,this.superArmor_attack=!0,this.node.setScale(new cc.Vec2(1,1)),this.shader.setScale(new cc.Vec2(1,1))):this.masterType==c.MASTER_TYPE.Yellowboss?(this.m_HP_MAX=this.m_HP_MAX*this.m_HP_Lv*20,this.m_HP=Math.floor(this.m_HP_MAX*t/100),this.m_Damage=Math.floor(this.m_Damage*this.m_Damage_Lv*10*e/100),this.m_putong_speed=2.5,this.m_AttackDistanceMin=100,this.m_AttackDistanceMax=300,this.m_attack_distance=300,this.hitFixedTimeMax=.5,this.m_IdleTimeDefault=2,this.superArmor_all=!0,this.superArmor_attack=!0,this.node.setScale(new cc.Vec2(1.1,1.1)),this.shader.setScale(new cc.Vec2(1.1,1.1))):this.masterType==c.MASTER_TYPE.Redboss&&(this.m_HP_MAX=this.m_HP_MAX*this.m_HP_Lv*40,this.m_HP=Math.floor(this.m_HP_MAX*t/100),this.m_Damage=Math.floor(this.m_Damage*this.m_Damage_Lv*20*e/100),this.m_putong_speed=2.5,this.m_AttackDistanceMin=150,this.m_AttackDistanceMax=350,this.m_attack_distance=350,this.hitFixedTimeMax=.5,this.m_IdleTimeDefault=2,this.superArmor_all=!0,this.superArmor_attack=!0,this.node.setScale(new cc.Vec2(1.1,1.1)),this.shader.setScale(new cc.Vec2(1.1,1.1))),this.setHPProgress()},e.prototype.setMasterAttributeByExcel=function(t,e){var i=y.MasterCfg.get(this.masterType);this.m_HP_Lv=Math.floor(Lite.myGame.g_Level/10)+1,this.m_Damage_Lv=Math.floor(Lite.myGame.g_Level/10)+1,this.m_HP_MAX=Math.floor(Number(i.hp)*this.m_HP_Lv*t/100),this.m_HP=this.m_HP_MAX,this.m_Damage=Math.floor(Number(i.attack)*e/100),this.m_putong_speed=Number(i.m_speed);var a=String(i.m_distance).split("|");this.m_AttackDistanceMin=Number(a[0]),this.m_AttackDistanceMax=Number(a[1]),this.m_attack_distance=Number(i.a_distance),this.hitFixedTimeMax=Number(i.fixed_time),this.m_IdleTimeDefault=Number(i.a_speed),this.superArmor_all=Boolean(i.super_armor),this.superArmor_attack=Boolean(i.a_super_armor),this.node.setScale(new cc.Vec2(Number(i.scale),Number(i.scale))),this.shader.setScale(new cc.Vec2(Number(i.scale),Number(i.scale)));var o=String(i.damage).split("|");this.m_Damage_Rate_Min=Number(o[0]),this.m_Damage_Rate_Max=Number(o[1])},e.prototype.setHPProgress=function(){this.m_Life_Progress.progress=this.m_HP/this.m_HP_MAX,0==this.m_HP?this.m_Life_Progress.node.active=!1:this.m_Life_Progress.node.active=!0},e.prototype.setMasterState=function(t){this.masterState=t,this.masterState==l.MASTER_STATE.E_State_Idle?this.setMixAni(this.aniState,m.MASTER_SPINE.DAIJI,0,!0):this.masterState==l.MASTER_STATE.E_State_Walk?this.setMixAni(this.aniState,m.MASTER_SPINE.MOVE,0,!0):this.masterState==l.MASTER_STATE.E_State_Attack?this.masterType==c.MASTER_TYPE.Bigman?(this.masterAttack(),this.bigManAttack()):this.masterType==c.MASTER_TYPE.Yellowboss?(this.masterAttack(),2==this.m_skill_type&&this.bigManAttack()):this.masterType==c.MASTER_TYPE.Redboss?1==this.m_skill_type?(this.masterAttack(),this.bigManAttack()):2==this.m_skill_type&&this.masterAttack():this.masterAttack():this.masterState==l.MASTER_STATE.E_State_Death?(this.setMixAni(this.aniState,m.MASTER_SPINE.DEATH,0,!1),Lite.myGame.map.map_master_num+=1,moosnow.event.sendEventImmediately(n.default.LEVEL_RATE_CHANGE,{})):this.masterState==l.MASTER_STATE.E_State_Hit&&this.setMixAni(this.aniState,m.MASTER_SPINE.HIT,0,!1)},e.prototype.setMasterAni=function(t,e){this.ske_com_master.setAnimation(0,t,e),this.aniState=t},e.prototype.setMixAni=function(t,e,i,a){this.ske_com_master.setMix(t,e,i),this.setMasterAni(e,a),this.aniState=e},e.prototype.updatezIndex=function(){this.node.parent.zIndex=1e3-this.node.y},e.prototype.aniEnd=function(){},e.prototype.aniComplete=function(){},e.prototype.masterAttack=function(){this.aniCompleteFlag&&(c.MASTER_TYPE.Yellowboss==this.masterType||c.MASTER_TYPE.Redboss==this.masterType?1==this.m_skill_type?this.setMixAni(this.aniState,m.MASTER_SPINE.ATTACK,0,!1):2==this.m_skill_type&&this.setMixAni(this.aniState,m.MASTER_SPINE.ATTACK2,0,!1):this.setMixAni(this.aniState,m.MASTER_SPINE.ATTACK,0,!1),this.m_HurtFlag=!0,this.aniCompleteFlag=!1)},e.prototype.masterDeath=function(t){if(t.masterNum==this.masterNum&&this.masterState!=l.MASTER_STATE.E_State_Death){this.m_Ai_State=_.MASTER_AI.AI_State_Death,this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.setMasterState(l.MASTER_STATE.E_State_Death),this.aniFrameHitIce&&this.aniFrameHitIce.active&&(this.aniFrameHitIce.active=!1),this.unscheduleAllCallbacks();for(var e=0;e<Lite.myGame.m_Array.length;e++)this.node.parent==Lite.myGame.m_Array[e]&&Lite.myGame.m_Array.splice(e,1);moosnow.event.sendEventImmediately(n.default.CREATE_COINS,{masterType:this.masterType,coinnum:this.m_Coin,pos:this.node.position}),this.warningFlag&&moosnow.event.sendEventImmediately(n.default.RECOVERY_COLLISION_WARN,{masterNum:this.masterNum}),Lite.myGame.m_Num-=1,0==Lite.myGame.m_Num&&(Lite.data.setTaskKillNum(Lite.myGame.m_Num_clone),Lite.myGame.map.updateBatch(),1==Lite.myGame.map.refreshNum?moosnow.event.sendEventImmediately(n.default.PLAYER_CAN_MOVE,{}):Lite.myGame.map.noticeCreateMaster(this.m_ref_time))}},e.prototype.masterHit=function(t){if(t.skillFlag&&this.masterState!=l.MASTER_STATE.E_State_Death){var e=Number(Lite.data.getPlayerEquipWeapon());if(e==p.WEAPON.W_Iron){if(t.masterNum==this.masterNum){this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.superArmor_all?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):this.superArmor_attack?this.masterState==l.MASTER_STATE.E_State_Attack||this.m_Ai_State==_.MASTER_AI.AI_State_Attack_Wait||this.m_Ai_State==_.MASTER_AI.AI_State_Attack?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax):this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax,this.aniFrameIron.play("hit_iron"),Lite.audio.masterHitJian();var i=Lite.myGame.player.getDamageRate(),a=Lite.myGame.player.checkCritical(),o=Math.floor(Lite.myGame.player.p_Skill_Damage*i/10);a&&(o=Math.ceil(o*Lite.myGame.player.critical_Damage/100)),this.m_HP-=o,this.createHitNum(o,a),this.m_HP<=0?(this.m_HP=0,this.setHPProgress(),t.masterNum=this.masterNum,this.masterDeath(t)):this.setHPProgress()}}else if(e==p.WEAPON.W_Dark)t.masterNum==this.masterNum&&(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.superArmor_all?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):this.superArmor_attack?this.masterState==l.MASTER_STATE.E_State_Attack||this.m_Ai_State==_.MASTER_AI.AI_State_Attack_Wait||this.m_Ai_State==_.MASTER_AI.AI_State_Attack?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax+.5,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax+.5):this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax+.5,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax+.5,Lite.audio.masterHit(),i=Lite.myGame.player.getDamageRate(),a=Lite.myGame.player.checkCritical(),o=Math.floor(Lite.myGame.player.p_Skill_Damage*i/10),a&&(o=Math.ceil(o*Lite.myGame.player.critical_Damage/100)),this.m_HP-=o,this.createHitNum(o,a),this.m_HP<=0?(this.m_HP=0,this.setHPProgress(),t.masterNum=this.masterNum,this.masterDeath(t)):this.setHPProgress());else if(e==p.WEAPON.W_ICE)t.masterNum==this.masterNum&&(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.superArmor_all?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):this.superArmor_attack?this.masterState==l.MASTER_STATE.E_State_Attack||this.m_Ai_State==_.MASTER_AI.AI_State_Attack_Wait||this.m_Ai_State==_.MASTER_AI.AI_State_Attack?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.hitFixedTimeIce<=0?(this.hitFixedTimeIce=this.hitFixedTimeIceMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTimeIce=this.hitFixedTimeIceMax,this.aniFrameIce&&(this.aniFrameHitIce.active=!0,this.aniFrameIce.play("hit_ice"))):(this.hitFixedTimeIce<=0?(this.hitFixedTimeIce=this.hitFixedTimeIceMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTimeIce=this.hitFixedTimeIceMax,this.aniFrameIce&&(this.aniFrameHitIce.active=!0,this.aniFrameIce.play("hit_ice"))),Lite.audio.masterHit(),i=Lite.myGame.player.getDamageRate(),a=Lite.myGame.player.checkCritical(),o=Math.floor(Lite.myGame.player.p_Skill_Damage*i/10),a&&(o=Math.ceil(o*Lite.myGame.player.critical_Damage/100)),this.m_HP-=o,this.createHitNum(o,a),this.m_HP<=0?(this.m_HP=0,this.setHPProgress(),t.masterNum=this.masterNum,this.masterDeath(t)):this.setHPProgress());else if(e==p.WEAPON.W_Blood)t.masterNum==this.masterNum&&(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.superArmor_all?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):this.superArmor_attack?this.masterState==l.MASTER_STATE.E_State_Attack||this.m_Ai_State==_.MASTER_AI.AI_State_Attack_Wait||this.m_Ai_State==_.MASTER_AI.AI_State_Attack?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax):this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax,this.aniFrame.play("hit1"),Lite.audio.masterHitJian(),i=Lite.myGame.player.getDamageRate(),a=Lite.myGame.player.checkCritical(),o=Math.floor(Lite.myGame.player.p_Skill_Damage*i/10),a&&(o=Math.ceil(o*Lite.myGame.player.critical_Damage/100)),this.m_HP-=o,this.createHitNum(o,a),this.m_HP<=0?(this.m_HP=0,this.setHPProgress(),t.masterNum=this.masterNum,this.masterDeath(t)):this.setHPProgress());else if(e==p.WEAPON.W_Poison){if(t.masterNum==this.masterNum){if(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.superArmor_all?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):this.superArmor_attack?this.masterState==l.MASTER_STATE.E_State_Attack||this.m_Ai_State==_.MASTER_AI.AI_State_Attack_Wait||this.m_Ai_State==_.MASTER_AI.AI_State_Attack?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax):this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax,this.poisonTime<=0){this.poisonTime=this.poisonTimeMax;var s=0,r=this.poisonTime;this.schedule(function(){++s<=r?this.masterState==l.MASTER_STATE.E_State_Death?s=r:this.debuffPoison(t):s==r+1&&(this.poisonTime=0,this.node.color=cc.Color.WHITE)},.5,r,1.5)}this.node.color=cc.Color.GREEN,Lite.audio.masterHitJian(),i=Lite.myGame.player.getDamageRate(),a=Lite.myGame.player.checkCritical(),o=Math.floor(Lite.myGame.player.p_Skill_Damage*i/10),a&&(o=Math.ceil(o*Lite.myGame.player.critical_Damage/100)),this.m_HP-=o,this.createHitNum(o,a),this.m_HP<=0?(this.m_HP=0,this.setHPProgress(),t.masterNum=this.masterNum,this.masterDeath(t)):this.setHPProgress()}}else this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.superArmor_all?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):this.superArmor_attack?this.masterState==l.MASTER_STATE.E_State_Attack||this.m_Ai_State==_.MASTER_AI.AI_State_Attack_Wait||this.m_Ai_State==_.MASTER_AI.AI_State_Attack?(this.checkDistanceFlage=!0,this.m_MoveFlag=!0):(this.checkDistanceFlage=!1,this.m_MoveFlag=!1,this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax):this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax,this.aniFrameIron.play("hit_iron"),Lite.audio.masterHitJian(),i=Lite.myGame.player.getDamageRate(),a=Lite.myGame.player.checkCritical(),o=Math.floor(Lite.myGame.player.p_Skill_Damage*i/10),a&&(o=Math.ceil(o*Lite.myGame.player.critical_Damage/100)),this.m_HP-=o,this.createHitNum(o,a),this.m_HP<=0?(this.m_HP=0,this.setHPProgress(),t.masterNum=this.masterNum,this.masterDeath(t)):this.setHPProgress()}else if(t.masterNum==this.masterNum&&this.masterState!=l.MASTER_STATE.E_State_Death&&Math.abs(this.node.y-Lite.myGame.player.node.y)<=30){if(this.superArmor_all)this.checkDistanceFlage=!0,this.m_MoveFlag=!0;else if(this.superArmor_attack)if(this.masterState==l.MASTER_STATE.E_State_Attack||this.m_Ai_State==_.MASTER_AI.AI_State_Attack_Wait||this.m_Ai_State==_.MASTER_AI.AI_State_Attack)this.checkDistanceFlage=!0,this.m_MoveFlag=!0;else{this.checkDistanceFlage=!1,this.m_MoveFlag=!1;var m=null;m=this.node.x<Lite.myGame.player.node.x?new cc.Vec2(this.node.x-30,this.node.y):new cc.Vec2(this.node.x+30,this.node.y);var h=cc.moveTo(.2,m);this.node.stopAllActions(),this.node.runAction(h),this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax}else this.checkDistanceFlage=!1,this.m_MoveFlag=!1,m=null,m=this.node.x<Lite.myGame.player.node.x?new cc.Vec2(this.node.x-30,this.node.y):new cc.Vec2(this.node.x+30,this.node.y),h=cc.moveTo(.2,m),this.node.stopAllActions(),this.node.runAction(h),this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax;this.aniFrame.play("hit1"),Lite.audio.masterHitJian(),i=Lite.myGame.player.getDamageRate(),a=Lite.myGame.player.checkCritical(),o=Math.floor(Lite.myGame.player.p_Damage*i/10),a&&(o=Math.ceil(o*Lite.myGame.player.critical_Damage/100)),this.m_HP-=o,this.createHitNum(o,a),this.m_HP<=0?(this.m_HP=0,this.setHPProgress(),this.masterDeath(t)):this.setHPProgress(),moosnow.event.sendEventImmediately(n.default.PLAYER_SKILL_RANGE,{})}},e.prototype.createHitNum=function(t,e){moosnow.event.sendEventImmediately(n.default.SHOW_LIANZHAN,{}),moosnow.event.sendEventImmediately(n.default.CREATE_HITNUM,{object:this.node,damage:t,c_flag:e,masterNum:this.masterNum})},e.prototype.masterAIReset=function(){this.poisonTime=0,this.node.color=cc.Color.WHITE,this.setPoint(),this.setMasterState(l.MASTER_STATE.E_State_Idle),this.updatezIndex(),this.addListener(),this.m_Ai_State=_.MASTER_AI.AI_State_Idle,this.collider.m_checkFlag=!0,this.collider.onLoad(),this.checkDistanceFlage=!0,this.m_MoveFlag=!0,this.deathTime=1.5,this.m_Life_Progress.node.scaleX=Math.abs(this.m_Life_Progress.node.scaleX),this.m_decision=0,this.m_movePoint=null,this.warningFlag=!1,this.m_skill_type=1,this.setAttackDistanceRandom(),this.setSkillType(),this.scheduleOnce(this.setDecisionOne,this.m_decision_change_time)},e.prototype.setDecisionOne=function(){this.m_decision=1,console.log("\u5f00\u542f\u7b2c\u4e00\u7b56\u7565 \u653b\u51fb\u6a21\u5f0f "+this.m_decision)},e.prototype.setAttackDistanceRandom=function(){this.unschedule(this.setDecisionOne),this.m_AttackDistanceRandom=moosnow.Common.randomNumBoth(this.m_AttackDistanceMin,this.m_AttackDistanceMax)},e.prototype.setSkillType=function(){this.masterType==c.MASTER_TYPE.Yellowboss||this.masterType==c.MASTER_TYPE.Redboss?this.m_skill_type=moosnow.Common.randomNumBoth(1,2):this.m_skill_type=1},e.prototype.setMasterDirection=function(){this.node.scaleX=0-this.node.scaleX,this.m_Life_Progress.node.scaleX=0-this.m_Life_Progress.node.scaleX},e.prototype.setMasterDirectionForPlayer=function(){Lite.myGame.player.node.x>this.node.x?(this.node.scaleX=Math.abs(this.node.scaleX),this.m_Life_Progress.node.scaleX=Math.abs(this.m_Life_Progress.node.scaleX)):(this.node.scaleX=0-Math.abs(this.node.scaleX),this.m_Life_Progress.node.scaleX=0-Math.abs(this.m_Life_Progress.node.scaleX))},e.prototype.changeAniColor=function(){var t=Number(Lite.data.getPlayerEquipWeapon());if(1!=t){var e=null;t==p.WEAPON.W_ICE?e=new cc.color(27,162,172,255):t==p.WEAPON.W_Poison?e=new cc.color(14,159,34,255):t==p.WEAPON.W_Blood?e=new cc.color(255,0,0,255):t==p.WEAPON.W_Dark?e=new cc.color(0,0,0,255):t==p.WEAPON.W_Light&&(e=new cc.color(255,255,100,255)),this.aniFrame.node.color=e}},e.prototype.bigManAttack=function(){var t;t=this.node.scaleX>0?new cc.Vec2(this.node.x+this.m_bump_distance,this.node.y):new cc.Vec2(this.node.x-this.m_bump_distance,this.node.y);var e=cc.callFunc(function(){this.masterState!=l.MASTER_STATE.E_State_Death&&(this.setSkillType(),this.setMasterState(l.MASTER_STATE.E_State_Idle),this.m_HurtFlag=!1)},this),i=cc.moveTo(.5,t),a=cc.sequence(i,e);this.node.stopAllActions(),this.node.runAction(a),this.warningFlag=!1,moosnow.event.sendEventImmediately(n.default.RECOVERY_COLLISION_WARN,{masterNum:this.masterNum})},e.prototype.debuffPoison=function(t){Lite.audio.masterHit();var e=Lite.myGame.player.getDamageRate(),i=Math.floor(Lite.myGame.player.p_Damage*e/10*this.poisonDamageRate/100);this.m_HP-=i,this.createHitNum(i,!1),this.m_HP<=0?(this.m_HP=0,this.poisonTime=0,this.setHPProgress(),this.masterDeath(t)):this.setHPProgress()},e.prototype.addListener=function(){moosnow.event.addListener(n.default.MASTER_DEATH,this,this.masterDeath),moosnow.event.addListener(n.default.MASTER_HIT,this,this.masterHit),moosnow.event.addListener(n.default.MASTER_CLEAR,this,this.clearMaster),moosnow.event.addListener(n.default.CHANGE_SKILL_TYPE,this,this.setSkillType)},e.prototype.removeListener=function(){moosnow.event.removeListener(n.default.MASTER_DEATH,this),moosnow.event.removeListener(n.default.MASTER_HIT,this),moosnow.event.removeListener(n.default.MASTER_CLEAR,this),moosnow.event.removeListener(n.default.CHANGE_SKILL_TYPE,this)},e.prototype.clearMaster=function(){this.masterType==c.MASTER_TYPE.Bigman&&moosnow.event.sendEventImmediately(n.default.RECOVERY_COLLISION_WARN,{masterNum:this.masterNum}),moosnow.event.sendEventImmediately(n.default.RECOVERY_MASTER,{enemy:this.node.parent,masterType:this.masterType})},e.prototype.moveWait=function(t){this.setMasterState(l.MASTER_STATE.E_State_Idle),this.m_Ai_State=_.MASTER_AI.AI_State_Wait,this.m_IdleTime=this.m_IdleTimeDefault,t&&this.setAttackDistanceRandom()},e.prototype.bumpAttack=function(){this.setMasterState(l.MASTER_STATE.E_State_Idle),this.m_Ai_State=_.MASTER_AI.AI_State_Attack_Wait,this.m_IdleTime=this.m_IdleTimeDefault,this.warningFlag=!0,moosnow.event.sendEventImmediately(n.default.SHOW_COLLISION_WARN,{x:this.node.x,y:this.node.y,masterNum:this.masterNum}),this.setMasterDirectionForPlayer()},e.prototype.directAttack=function(){this.m_AttackTime=this.m_AttackTimeMax,this.setMasterState(l.MASTER_STATE.E_State_Attack),this.m_Ai_State=_.MASTER_AI.AI_State_Idle,this.m_IdleTime=this.m_IdleTimeDefault},e.prototype.perpetualAttack=function(t,e){var i=10-t;moosnow.Common.randomNumBoth(1,10)>i?(this.m_Ai_State=_.MASTER_AI.AI_State_Wait,this.m_IdleTime=this.m_IdleTimeDefault/e):(2==this.m_decision&&(this.m_movePoint=null),this.setAttackDistanceRandom())},e.prototype.moveNow=function(){this.m_Ai_State=_.MASTER_AI.AI_State_Walk,this.m_IdleTime=this.m_IdleTimeDefault,this.m_MoveFlag=!0},e.prototype.onDisable=function(){this.removeListener()},e.prototype.update=function(t){if(this.masterState==l.MASTER_STATE.E_State_Death?this.node.scaleX<0?this.shader.setPosition(this.node.x-this.bone.x,this.node.y+5):this.shader.setPosition(this.node.x+this.bone.x,this.node.y+5):this.node.scaleX<0?this.shader.setPosition(this.node.x-this.bone.x+15,this.node.y+5):this.shader.setPosition(this.node.x+this.bone.x-15,this.node.y+5),this.hitFixedTimeIce>0?this.hitFixedTimeIce-=t:(this.masterState==l.MASTER_STATE.E_State_Hit&&Lite.myGame.player.weaponId==p.WEAPON.W_ICE&&(this.aniFrameHitIce.active=!1,this.setMasterState(l.MASTER_STATE.E_State_Idle),this.checkDistanceFlage=!0,this.m_MoveFlag=!0),this.hitFixedTime>0?this.hitFixedTime-=t:this.masterState==l.MASTER_STATE.E_State_Hit&&(this.setMasterState(l.MASTER_STATE.E_State_Idle),this.checkDistanceFlage=!0,this.m_MoveFlag=!0)),this.masterState==l.MASTER_STATE.E_State_Death?(this.checkDistanceFlage=!1,this.deathTime<=0?this.clearMaster():this.deathTime-=t):this.masterState!=l.MASTER_STATE.E_State_Attack&&((this.masterType==c.MASTER_TYPE.Bigman||this.masterType==c.MASTER_TYPE.Yellowboss)&&(this.m_Ai_State==_.MASTER_AI.AI_State_Attack_Wait||this.m_Ai_State==_.MASTER_AI.AI_State_Attack)||(Lite.myGame.player.node.position.x<this.node.position.x?this.node.scaleX>0&&this.setMasterDirection():this.node.scaleX<0&&this.setMasterDirection())),this.m_Ai_State==_.MASTER_AI.AI_State_Idle||this.m_Ai_State==_.MASTER_AI.AI_State_Wait||this.m_Ai_State==_.MASTER_AI.AI_State_Attack_Wait){if(this.m_IdleTime>0)return void(this.m_IdleTime-=t);this.m_Ai_State==_.MASTER_AI.AI_State_Idle?this.m_Ai_State=_.MASTER_AI.AI_State_Walk:this.m_Ai_State!=_.MASTER_AI.AI_State_Wait&&this.m_Ai_State!=_.MASTER_AI.AI_State_Attack_Wait||(this.m_Ai_State=_.MASTER_AI.AI_State_Attack)}if(this.m_AttackTime>0)this.m_AttackTime-=t;else{this.m_HurtFlag=!1,this.aniCompleteFlag=!0;var e=new cc.Vec3(Lite.myGame.player.node.position.x,Lite.myGame.player.node.position.y,0),i=new cc.Vec3(this.node.position.x,this.node.position.y,0);if(this.m_movePoint&&(e=this.m_movePoint),this.checkDistanceFlage){var a=d.default.getDistance(this.node.position,e);if(0==this.m_decision&&(this.m_decision=moosnow.Common.randomNumBoth(1,2),c.MASTER_TYPE.Yellowboss!=this.masterType&&c.MASTER_TYPE.Redboss!=this.masterType||(this.m_decision=1)),c.MASTER_TYPE.Putong==this.masterType||c.MASTER_TYPE.Black==this.masterType||c.MASTER_TYPE.Gangguan==this.masterType||c.MASTER_TYPE.Bigman==this.masterType||c.MASTER_TYPE.Yellowboss==this.masterType||c.MASTER_TYPE.Redboss==this.masterType)if(1==this.m_decision)if(null==this.m_movePoint)if(a<=this.m_AttackDistanceRandom){if(this.m_MoveFlag=!1,this.m_Ai_State==_.MASTER_AI.AI_State_Walk)c.MASTER_TYPE.Bigman==this.masterType?Math.abs(this.node.y-Lite.myGame.player.node.y)<=30||Math.abs(this.node.x-Lite.myGame.player.node.x)<=this.m_attack_distance?this.bumpAttack():(this.setMasterState(l.MASTER_STATE.E_State_Idle),this.m_IdleTime=this.m_IdleTimeDefault,this.setAttackDistanceRandom()):c.MASTER_TYPE.Yellowboss==this.masterType?Math.abs(this.node.x-Lite.myGame.player.node.x)<=this.m_attack_distance&&1==this.m_skill_type?this.moveWait(!0):Math.abs(this.node.x-Lite.myGame.player.node.x)<=this.m_attack_distance+200&&2==this.m_skill_type&&Math.abs(this.node.y-Lite.myGame.player.node.y)<=50?this.bumpAttack():this.moveWait(!0):this.moveWait(!0);else if(this.m_Ai_State==_.MASTER_AI.AI_State_Attack)if(c.MASTER_TYPE.Bigman==this.masterType)this.directAttack(),this.perpetualAttack(0,1);else if(c.MASTER_TYPE.Yellowboss==this.masterType&&2==this.m_skill_type)this.directAttack(),this.perpetualAttack(0,1);else{var o=30;if(c.MASTER_TYPE.Redboss==this.masterType&&(o=50),Math.abs(this.node.y-Lite.myGame.player.node.y)<=o)this.directAttack(),c.MASTER_TYPE.Redboss==this.masterType?this.perpetualAttack(0,1):this.perpetualAttack(3,2);else{var s=moosnow.Common.randomNumBoth(this.m_AttackDistanceMin,this.m_AttackDistanceMax),n=moosnow.Common.randomNumBoth(10,30);0==moosnow.Common.randomNumBoth(0,1)&&(s=0-s),0==moosnow.Common.randomNumBoth(0,1)&&(n=0-n),this.m_movePoint=new cc.Vec3(Lite.myGame.player.node.position.x+s,Lite.myGame.player.node.position.y+n),this.moveNow()}}}else this.m_Ai_State==_.MASTER_AI.AI_State_Attack?c.MASTER_TYPE.Bigman==this.masterType?(this.directAttack(),this.setAttackDistanceRandom()):c.MASTER_TYPE.Yellowboss==this.masterType&&2==this.m_skill_type?(this.directAttack(),this.setAttackDistanceRandom()):this.moveNow():this.moveNow();else a<=5&&(this.m_movePoint=null,Math.abs(this.node.y-Lite.myGame.player.node.y)<=30&&(Math.abs(this.node.x-Lite.myGame.player.node.x),this.m_attack_distance));else 2==this.m_decision&&(null==this.m_movePoint?(s=moosnow.Common.randomNumBoth(this.m_AttackDistanceMin,this.m_AttackDistanceMax),n=moosnow.Common.randomNumBoth(0,150),0==moosnow.Common.randomNumBoth(0,1)&&(s=0-s),0==moosnow.Common.randomNumBoth(0,1)&&(n=0-n),this.m_movePoint=new cc.Vec3(Lite.myGame.player.node.position.x+s,Lite.myGame.player.node.position.y+n),this.m_movePoint.y>Lite.myGame.map.map_Up?this.m_movePoint.y=Lite.myGame.map.map_Up:this.m_movePoint.y<Lite.myGame.map.map_Down&&(this.m_movePoint.y=Lite.myGame.map.map_Down),this.moveNow()):a<=5?(this.m_MoveFlag=!1,this.m_Ai_State==_.MASTER_AI.AI_State_Walk?c.MASTER_TYPE.Bigman==this.masterType?Math.abs(this.node.y-Lite.myGame.player.node.y)<=30||Math.abs(this.node.x-Lite.myGame.player.node.x)<=this.m_attack_distance?this.bumpAttack():(this.setMasterState(l.MASTER_STATE.E_State_Idle),this.m_IdleTime=this.m_IdleTimeDefault):c.MASTER_TYPE.Yellowboss==this.masterType?Math.abs(this.node.x-Lite.myGame.player.node.x)<=this.m_attack_distance?(this.m_skill_type=1,this.moveWait(!1)):Math.abs(this.node.x-Lite.myGame.player.node.x)<=this.m_attack_distance+200?Math.abs(this.node.y-Lite.myGame.player.node.y)<=50?(this.m_skill_type=2,this.bumpAttack()):(this.setMasterState(l.MASTER_STATE.E_State_Idle),this.m_IdleTime=this.m_IdleTimeDefault):this.moveWait(!1):this.moveWait(!1):this.m_Ai_State==_.MASTER_AI.AI_State_Attack&&(c.MASTER_TYPE.Bigman==this.masterType?(this.directAttack(),this.m_movePoint=null):c.MASTER_TYPE.Yellowboss==this.masterType&&2==this.m_skill_type?(this.directAttack(),this.m_movePoint=null):(o=30,c.MASTER_TYPE.Redboss==this.masterType&&(o=50),Math.abs(this.node.y-Lite.myGame.player.node.y)<=o&&Math.abs(this.node.x-Lite.myGame.player.node.x)<=this.m_attack_distance?(this.directAttack(),c.MASTER_TYPE.Redboss==this.masterType?this.perpetualAttack(0,1):this.perpetualAttack(5,2)):this.m_movePoint=null)),c.MASTER_TYPE.Bigman==this.masterType||c.MASTER_TYPE.Yellowboss==this.masterType&&2==this.m_skill_type||c.MASTER_TYPE.Redboss==this.masterType||this.perpetualAttack(3,2)):this.m_Ai_State==_.MASTER_AI.AI_State_Attack&&(c.MASTER_TYPE.Bigman==this.masterType?(this.directAttack(),this.m_movePoint=null):c.MASTER_TYPE.Yellowboss==this.masterType&&2==this.m_skill_type&&(this.directAttack(),this.m_movePoint=null)))}if(this.m_MoveFlag){var r=new cc.Vec3,m=new cc.Vec3,h=new cc.Vec3;cc.Vec3.subtract(r,e,i),cc.Vec3.normalize(m,r),m.mul(this.m_putong_speed,h),this.masterState!=l.MASTER_STATE.E_State_Walk&&this.setMasterState(l.MASTER_STATE.E_State_Walk),this.node.setPosition(this.node.position.add(h)),this.updatezIndex()}}},s([S(cc.ProgressBar)],e.prototype,"m_Life_Progress",void 0),s([S(cc.Node)],e.prototype,"aniFrameHit",void 0),s([S(cc.Node)],e.prototype,"aniFrameHitIce",void 0),s([S(cc.Node)],e.prototype,"aniFrameHitIron",void 0),s([S(cc.Label)],e.prototype,"masterName",void 0),s([S(cc.Node)],e.prototype,"shader",void 0),s([A],e)}(r.default);i.default=E,cc._RF.pop()},{"../../../script/entity/BaseControl":void 0,"../../../script/enum/MASTER_AI":void 0,"../../../script/enum/MASTER_SPINE":void 0,"../../../script/enum/MASTER_STATE":void 0,"../../../script/enum/MASTER_TYPE":void 0,"../../../script/enum/WEAPON":void 0,"../../../script/framework/utils/FrameworkEvent":void 0,"../../../script/framework/utils/MathUtils":void 0,"../../../sheets/vo/MasterCfg":void 0,"./ColliderListener":"ColliderListener"}],PlayerControl:[function(t,e,i){"use strict";cc._RF.push(e,"b7a95GsiZdI+oEq+b8ipREG","PlayerControl");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../script/framework/utils/FrameworkEvent"),r=t("../../../script/entity/BaseControl"),m=t("./MasterControl"),l=t("../../../script/framework/utils/MathUtils"),h=t("../../../script/enum/PLAYER_SPINE"),c=t("../../../script/enum/PLAYER_STATE"),_=t("../../../script/enum/MASTER_TYPE"),p=t("../../../script/enum/WEAPON"),d=t("../../../sheets/vo/PlayerUpgrade"),y=t("../../../sheets/vo/WeaponCfg"),u=cc._decorator,A=u.ccclass,S=u.property,E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.p_Life_Progress=null,e.aniFrameHit=null,e.aniFrameSkill=null,e.aniFrameSkill_5=null,e.aniFrameSkill_4=null,e.aniFrameSkill_2=null,e.aniFrameSkill_3=null,e.shader=null,e.hitnumPrefab=null,e.txtHp=null,e.ske_com_player=null,e.playerState=c.PLAYER_STATE.E_State_Idle,e.aniState=h.PLAYER_SPINE.DAIJI2,e.ani=null,e.attackState=0,e.attackTimeFlag=!1,e.attackTime=2,e.attackTimeMax=2,e.attackStateMax=3,e.aniCompleteFlag=!0,e.playerHurtFlag=!1,e.attackCollider=null,e.pleyerTag=6666,e.attackTag=10001,e.hitnumPool=null,e.aniFrame=null,e.weaponSlot=null,e.bone=null,e.weaponId=1,e.weaponData=null,e.p_HP=60,e.p_HP_MAX=1,e.p_HP_Lv=1,e.p_Damage=12,e.p_Damage_Lv=1,e.p_Weapon_Attack=0,e.p_Energy=0,e.p_Skill_Damage=0,e.p_Skill_Part=0,e.p_Skill_Range=0,e.p_Skill_Buff=0,e.p_Attack_Speed=0,e.p_Attack_Speed_default=0,e.p_Attack_Speed_Flag=!0,e.hitFixedTime=0,e.hitFixedTimeMax=.8,e.critical_Rate=0,e.critical_Damage=0,e.p_Damage_Rate_Min=0,e.p_Damage_Rate_Max=0,e.p_Skill_Pos=null,e.p_Invincible=!1,e.sp_state=null,e.sp_state_data=null,e}return o(e,t),e.prototype.onLoad=function(){Lite.myGame.player=this,this.ani=this.node.getChildByName("act"),this.ske_com_player=this.ani.getComponent(sp.Skeleton),this.sp_state=this.ske_com_player.getState(),this.sp_state_data=this.sp_state.data,this.weaponSlot=this.ske_com_player.findSlot("dao"),this.bone=this.ske_com_player.findBone("bone"),this.ske_com_player.setCompleteListener(this.aniComplete),this.aniFrame=this.aniFrameHit.getComponent(cc.Animation)},e.prototype.init=function(){Lite.myGame.cameraControl.mCamera.node.setPosition(new cc.Vec2(0,0)),this.setPlayerState(c.PLAYER_STATE.E_State_Idle),this.addListener(),this.createHitNumPool(),this.setPoint(),this.setPlayerAttributeByExcel(),this.attachmentChange(),this.updatezIndex(),this.node.setScale(new cc.Vec2(.6,.6))},e.prototype.setPoint=function(){var t=Lite.myGame.cameraControl.mCamera.node.position.x+50,e=new cc.Vec2(t,720);this.node.setPosition(e)},e.prototype.setPlayerAttribute=function(){this.p_HP_MAX=Number(d.PlayerUpgrade.get(Lite.data.getPlayerHPLevel()).hp),this.p_HP_MAX=this.p_HP_MAX+Math.round(this.p_HP_MAX*Lite.myGame.hp_addition),this.p_HP=this.p_HP_MAX,this.p_Damage=Number(d.PlayerUpgrade.get(Lite.data.getPlayerAttackLevel()).attack),this.p_Damage=this.p_Damage+Math.round(this.p_Damage*Lite.myGame.attack_addition),this.p_Skill_Damage=Math.floor(200*this.p_Damage/100),this.p_Skill_Part=5,this.txtHp.string=this.p_HP.toString(),this.p_Damage_Rate_Min=.8,this.p_Damage_Rate_Max=1.2,this.critical_Rate=30,this.critical_Damage=200,this.p_Attack_Speed=.5,this.p_Attack_Speed_default=.5,this.weaponId=Number(Lite.data.getPlayerEquipWeapon()),this.weaponData=y.WeaponCfg.get(this.weaponId),this.weaponId==p.WEAPON.W_Iron?(this.p_Attack_Speed=Number(this.weaponData.speed),this.p_Attack_Speed_default=Number(this.weaponData.speed),this.critical_Rate=Number(this.weaponData.critical),this.critical_Damage=200):this.weaponId==p.WEAPON.W_ICE?(this.p_Attack_Speed=.3,this.p_Attack_Speed_default=.3):this.weaponId==p.WEAPON.W_Poison?this.p_Skill_Damage=Math.floor(50*this.p_Damage/100):this.weaponId==p.WEAPON.W_Blood?this.critical_Rate=100:this.weaponId==p.WEAPON.W_Dark?(this.p_Attack_Speed=.8,this.p_Attack_Speed_default=.8,this.p_Damage_Rate_Min=2*this.p_Damage_Rate_Min,this.p_Damage_Rate_Max=2*this.p_Damage_Rate_Max,this.p_Skill_Damage=Math.floor(300*this.p_Damage/100)):this.weaponId==p.WEAPON.W_Light&&(this.p_Attack_Speed=.2,this.p_Attack_Speed_default=.2,this.p_Damage_Rate_Min=2*this.p_Damage_Rate_Min,this.p_Damage_Rate_Max=3*this.p_Damage_Rate_Max),this.setHPProgress()},e.prototype.setPlayerAttributeByExcel=function(){this.p_HP_MAX=Number(d.PlayerUpgrade.get(Lite.data.getPlayerHPLevel()).hp),this.p_HP_MAX=this.p_HP_MAX+Math.round(this.p_HP_MAX*Lite.myGame.hp_addition/100),this.p_HP=this.p_HP_MAX,this.txtHp.string=this.p_HP.toString(),this.p_Damage=Number(d.PlayerUpgrade.get(Lite.data.getPlayerAttackLevel()).attack),this.p_Damage=this.p_Damage+Math.round(this.p_Damage*Lite.myGame.attack_addition/100),this.weaponId=Number(Lite.data.getPlayerEquipWeapon()),this.weaponData=y.WeaponCfg.get(this.weaponId),this.p_Weapon_Attack=Number(this.weaponData.attack),this.p_Damage+=this.p_Weapon_Attack,this.p_Attack_Speed=Number(this.weaponData.speed),this.p_Attack_Speed_default=Number(this.weaponData.speed),this.critical_Rate=100*Number(this.weaponData.critical),this.critical_Damage=100*Number(this.weaponData.critical_damage),this.p_Skill_Damage=Math.floor(100*this.p_Damage*Number(this.weaponData.skill_damage)/100),this.p_Skill_Part=Number(this.weaponData.skill_parts);var t=String(this.weaponData.damage).split("|");this.p_Damage_Rate_Min=Number(t[0]),this.p_Damage_Rate_Max=Number(t[1]),this.p_Skill_Range=Number(this.weaponData.skill_range),this.p_Skill_Buff=Number(this.weaponData.skill_buff),this.setHPProgress()},e.prototype.setHPProgress=function(){this.p_Life_Progress.progress=this.p_HP/this.p_HP_MAX,0==this.p_HP?(this.txtHp.string="0",this.p_Life_Progress.node.active=!1):(this.txtHp.string=this.p_HP.toString(),this.p_Life_Progress.node.active=!0)},e.prototype.setPlayerState=function(t){if(this.playerState=t,this.playerState==c.PLAYER_STATE.E_State_Idle)this.setMixAni(this.aniState,h.PLAYER_SPINE.DAIJI2,0,!0);else if(this.playerState==c.PLAYER_STATE.E_State_Idle2)this.setMixAni(this.aniState,h.PLAYER_SPINE.DAIJI2,0,!0);else if(this.playerState==c.PLAYER_STATE.E_State_Walk)this.aniCompleteFlag=!0,this.setMixAni(this.aniState,h.PLAYER_SPINE.MOVE,0,!0);else if(this.playerState==c.PLAYER_STATE.E_State_Attack)this.p_Attack_Speed_Flag&&(this.p_Attack_Speed_Flag=!1,this.p_Attack_Speed=this.p_Attack_Speed_default,this.aniCompleteFlag=!0,this.playerAttack());else if(this.playerState==c.PLAYER_STATE.E_State_Death)this.setMixAni(this.aniState,h.PLAYER_SPINE.DEATH,0,!1);else if(this.playerState==c.PLAYER_STATE.E_State_Hit)this.setMixAni(this.aniState,h.PLAYER_SPINE.HIT,0,!1);else if(this.playerState==c.PLAYER_STATE.E_State_Skill)if(this.weaponId==p.WEAPON.W_Iron){this.setMixAni(this.aniState,h.PLAYER_SPINE.HENG1,0,!1);var e=0;this.schedule(function(){if(e++,this.playerState==c.PLAYER_STATE.E_State_Skill&&(this.ani.active=!1,this.playerSkillIron(),13==e)){var t=cc.callFunc(function(){this.ani.active=!0,this.setPlayerState(c.PLAYER_STATE.E_State_Idle)},this),i=cc.moveTo(.1,this.p_Skill_Pos),a=cc.sequence(i,t);this.node.stopAllActions(),this.node.runAction(a)}},.1,12,.1)}else if(this.weaponId==p.WEAPON.W_Dark){var i=0;this.setMixAni(this.aniState,h.PLAYER_SPINE.SKILL,0,!1),this.schedule(function(){i++,this.playerState==c.PLAYER_STATE.E_State_Skill&&(i<=3?(Lite.audio.playerSkill_5(),this.playerSkillDark()):4==i&&(this.weaponSlot.color.a=1,this.setPlayerState(c.PLAYER_STATE.E_State_Idle)))},.3,3,.4)}else if(this.weaponId==p.WEAPON.W_ICE){Lite.audio.playerSkill_2();var a=0;this.setMixAni(this.aniState,h.PLAYER_SPINE.SKILL,0,!1),this.schedule(function(){a++,this.playerState==c.PLAYER_STATE.E_State_Skill&&(a<=1?this.playerSkillIce():2==a&&this.setPlayerState(c.PLAYER_STATE.E_State_Idle))},.3,1,.4)}else if(this.weaponId==p.WEAPON.W_Blood){Lite.audio.playerSkill_4();var o=0;this.setMixAni(this.aniState,h.PLAYER_SPINE.HENG1,0,!1),this.schedule(function(){o++,this.playerState==c.PLAYER_STATE.E_State_Skill&&(o<=10?this.playerSkillBlood():11==o&&this.setPlayerState(c.PLAYER_STATE.E_State_Idle))},.1,10,.2)}else if(this.weaponId==p.WEAPON.W_Poison){Lite.audio.playerSkill_3();var s=0;this.setMixAni(this.aniState,h.PLAYER_SPINE.SKILL,0,!1),this.schedule(function(){s++,this.playerState==c.PLAYER_STATE.E_State_Skill&&(s<=12?this.playerSkillPoison():13==s&&(this.weaponSlot.color.a=1,this.setPlayerState(c.PLAYER_STATE.E_State_Idle)))},.1,12,.28)}else{this.setMixAni(this.aniState,h.PLAYER_SPINE.TIAO1,0,!1),Lite.audio.playerSkill();var r=0;this.schedule(function(){r++,moosnow.event.sendEventImmediately(n.default.MASTER_HIT,{masterNum:-1,skillFlag:!0}),r==this.p_Skill_Part&&this.setPlayerState(c.PLAYER_STATE.E_State_Idle)},.3,this.p_Skill_Part,.1)}},e.prototype.setPlayerAni=function(t,e){this.ske_com_player.setAnimation(0,t,e),this.aniState=t},e.prototype.setMixAni=function(t,e,i,a){this.ske_com_player.setMix(t,e,i),this.setPlayerAni(e,a),this.playerState==c.PLAYER_STATE.E_State_Attack&&moosnow.event.sendEventImmediately(n.default.PLAYER_ANIM,{aniName:e}),this.aniState=e},e.prototype.updatezIndex=function(){this.node.parent.zIndex=1e3-this.node.y},e.prototype.getDamageRate=function(){return moosnow.Common.randomNumBoth(10*this.p_Damage_Rate_Min,10*this.p_Damage_Rate_Max)},e.prototype.aniEnd=function(){},e.prototype.aniComplete=function(){Lite.myGame.player.playerState==c.PLAYER_STATE.E_State_Attack?(Lite.myGame.player.aniCompleteFlag=!0,Lite.myGame.player.setPlayerState(c.PLAYER_STATE.E_State_Idle)):Lite.myGame.player.playerState==c.PLAYER_STATE.E_State_Death&&(moosnow.event.sendEventImmediately(n.default.MASTER_CLEAR,{}),moosnow.event.sendEventImmediately(n.default.PLAYER_STATE_DEATH,{}))},e.prototype.playerAttack=function(){if(this.aniCompleteFlag){switch(this.attackState==this.attackStateMax&&(this.attackState=0),this.attackState+=1,this.attackState){case 1:Lite.audio.playAttack1(),this.setMixAni(this.aniState,h.PLAYER_SPINE.ZUO1,0,!1),this.playerHurtFlag=!0,this.aniCompleteFlag=!1;break;case 2:Lite.audio.playAttack2(),this.setMixAni(this.aniState,h.PLAYER_SPINE.YOU1,0,!1),this.playerHurtFlag=!0,this.aniCompleteFlag=!1;break;case 3:Lite.audio.playAttack3(),Lite.audio.playerHa(),this.setMixAni(this.aniState,h.PLAYER_SPINE.HENG1,0,!1),this.playerHurtFlag=!0,this.aniCompleteFlag=!1;break;case 4:this.setMixAni(this.aniState,h.PLAYER_SPINE.TIAO1,0,!1),this.playerHurtFlag=!0,this.aniCompleteFlag=!1;break;case 5:this.setMixAni(this.aniState,h.PLAYER_SPINE.HENG1,0,!1),this.playerHurtFlag=!0,this.aniCompleteFlag=!1}moosnow.event.sendEventImmediately(n.default.CAN_HIT,{checkFlag:!0})}},e.prototype.playerDeath=function(){this.setPlayerState(c.PLAYER_STATE.E_State_Death)},e.prototype.playerHit=function(t){if(!this.p_Invincible){var e=30,i=100;if(this.playerState!=c.PLAYER_STATE.E_State_Death&&this.playerState!=c.PLAYER_STATE.E_State_Skill&&(t.masterType!=_.MASTER_TYPE.Bigman&&t.masterType!=_.MASTER_TYPE.Yellowboss&&t.masterType!=_.MASTER_TYPE.Redboss||(e=50,i=180),Math.abs(this.node.y-Number(t.m_pos_y))<=e)){var a=null,o=null,s=0;if(Number(t.m_pos_x)<this.node.x)this.setPlayerDirection(1),(n=Lite.myGame.cameraControl.mCamera.node.x+i)>(m=Lite.myGame.map.mapSize.width-Lite.myGame.cameraControl.rightDis)-375&&(n=m-375,o=new cc.Vec2(n,Lite.myGame.cameraControl.mCamera.node.y)),700-(s=Math.abs(n-this.node.x))<i?a=new cc.Vec2(this.node.x+(700-s),this.node.y):((r=this.node.x+i-Lite.myGame.cameraControl.leftDis)<0?o=new cc.Vec2(Lite.myGame.cameraControl.mCamera.node.x,Lite.myGame.cameraControl.mCamera.node.y):r<i&&(Lite.myGame.cameraControl.cameraMoveFlag=!1,o=new cc.Vec2(Lite.myGame.cameraControl.mCamera.node.x+r,Lite.myGame.cameraControl.mCamera.node.y)),a=new cc.Vec2(this.node.x+i,this.node.y),null==o&&(o=new cc.Vec2(Lite.myGame.cameraControl.mCamera.node.x+i,Lite.myGame.cameraControl.mCamera.node.y)));else{var n;this.setPlayerDirection(0),(n=Lite.myGame.cameraControl.mCamera.node.x-i)<Lite.myGame.cameraControl.leftDis-375&&(n=Lite.myGame.cameraControl.leftDis-375,o=new cc.Vec2(n,Lite.myGame.cameraControl.mCamera.node.y));var r,m=Lite.myGame.map.mapSize.width-Lite.myGame.cameraControl.rightDis;(s=Math.abs(n-this.node.x))<i?a=new cc.Vec2(this.node.x-s,this.node.y):((r=this.node.x-m-i)>0?o=new cc.Vec2(Lite.myGame.cameraControl.mCamera.node.x,Lite.myGame.cameraControl.mCamera.node.y):r>-i&&(Lite.myGame.cameraControl.cameraMoveFlag=!1,o=new cc.Vec2(Lite.myGame.cameraControl.mCamera.node.x+r,Lite.myGame.cameraControl.mCamera.node.y)),a=new cc.Vec2(this.node.x-i,this.node.y),null==o&&(o=new cc.Vec2(Lite.myGame.cameraControl.mCamera.node.x-i,Lite.myGame.cameraControl.mCamera.node.y)))}var l=!0;if(t.masterType==_.MASTER_TYPE.Yellowboss&&1==t.m_skill_type?l=t.end_flag:t.masterType==_.MASTER_TYPE.Redboss&&(l=t.end_flag),l){var h=cc.moveTo(.1,a),p=cc.moveTo(.1,o);this.node.stopAllActions(),Lite.myGame.cameraControl.mCamera.node.stopAllActions(),this.node.runAction(h),Lite.myGame.cameraControl.mCamera.node.runAction(p)}this.hitFixedTime<=0?(this.hitFixedTime=this.hitFixedTimeMax,this.setPlayerState(c.PLAYER_STATE.E_State_Hit)):this.hitFixedTime=this.hitFixedTimeMax,this.aniFrame.play("p_hit"),Lite.audio.playerHit();var d=Number(t.damage);this.p_HP-=d,this.createHitNum(d),this.p_HP<=0?(this.p_HP=0,this.setHPProgress(),this.playerDeath(t)):this.setHPProgress()}}},e.prototype.playerSkill=function(){if(Number(Lite.data.getPlayerEquipWeapon())==p.WEAPON.W_Iron){if(Lite.myGame.m_Array.length>0){for(var t=Lite.myGame.cameraControl.mCamera.node.position.x,e=Lite.myGame.cameraControl.mCamera.node.position.x+750,i=!1,a=0;a<Lite.myGame.m_Array.length;a++)if(t<Lite.myGame.m_Array[a].children[1].position.x&&Lite.myGame.m_Array[a].children[1].position.x<e){i=!0;break}i&&(this.p_Skill_Pos=new cc.Vec3(t+375,this.node.position.y,0),this.setPlayerState(c.PLAYER_STATE.E_State_Skill),moosnow.event.sendEventImmediately(n.default.PLAYER_SKILL_RANGE,{clearRange:!0}))}}else if(Number(Lite.data.getPlayerEquipWeapon())==p.WEAPON.W_Dark){var o=this.aniFrameSkill_5.getComponent(cc.Animation);if(this.weaponSlot&&(this.weaponSlot.color.a=0),this.ani.scaleX>0){this.aniFrameSkill_5.scaleX=0-Math.abs(this.aniFrameSkill_5.scaleX);var s=new cc.Vec2(164,this.aniFrameSkill_5.position.y);this.aniFrameSkill_5.setPosition(s)}else this.aniFrameSkill_5.scaleX=Math.abs(this.aniFrameSkill_5.scaleX),s=new cc.Vec2(-164,this.aniFrameSkill_5.position.y),this.aniFrameSkill_5.setPosition(s);o.play("p_skill_5"),this.setPlayerState(c.PLAYER_STATE.E_State_Skill),moosnow.event.sendEventImmediately(n.default.PLAYER_SKILL_RANGE,{clearRange:!0})}else Number(Lite.data.getPlayerEquipWeapon())==p.WEAPON.W_ICE?(o=this.aniFrameSkill_2.getComponent(cc.Animation),this.ani.scaleX>0?this.aniFrameSkill_2.scaleX=0-Math.abs(this.aniFrameSkill_2.scaleX):this.aniFrameSkill_2.scaleX=Math.abs(this.aniFrameSkill_2.scaleX),o.play("p_skill_2"),this.setPlayerState(c.PLAYER_STATE.E_State_Skill),moosnow.event.sendEventImmediately(n.default.PLAYER_SKILL_RANGE,{clearRange:!0})):Number(Lite.data.getPlayerEquipWeapon())==p.WEAPON.W_Blood?(o=this.aniFrameSkill_4.getComponent(cc.Animation),this.ani.scaleX>0?this.aniFrameSkill_4.scaleX=0-Math.abs(this.aniFrameSkill_4.scaleX):this.aniFrameSkill_4.scaleX=Math.abs(this.aniFrameSkill_4.scaleX),o.play("p_skill_4"),this.setPlayerState(c.PLAYER_STATE.E_State_Skill),moosnow.event.sendEventImmediately(n.default.PLAYER_SKILL_RANGE,{clearRange:!0})):Number(Lite.data.getPlayerEquipWeapon())==p.WEAPON.W_Poison?(o=this.aniFrameSkill_3.getComponent(cc.Animation),this.weaponSlot&&(this.weaponSlot.color.a=0),this.ani.scaleX>0?(this.aniFrameSkill_3.scaleX=0-Math.abs(this.aniFrameSkill_3.scaleX),s=new cc.Vec2(375,this.aniFrameSkill_3.position.y),this.aniFrameSkill_3.setPosition(s)):(this.aniFrameSkill_3.scaleX=Math.abs(this.aniFrameSkill_3.scaleX),s=new cc.Vec2(-375,this.aniFrameSkill_3.position.y),this.aniFrameSkill_3.setPosition(s)),o.play("p_skill_3"),this.setPlayerState(c.PLAYER_STATE.E_State_Skill),moosnow.event.sendEventImmediately(n.default.PLAYER_SKILL_RANGE,{clearRange:!0})):((o=this.aniFrameSkill.getComponent(cc.Animation)).play("p_skill_0"),this.setPlayerState(c.PLAYER_STATE.E_State_Skill),moosnow.event.sendEventImmediately(n.default.PLAYER_SKILL_RANGE,{clearRange:!0}))},e.prototype.playerSkillIron=function(){for(var t=Lite.myGame.cameraControl.mCamera.node.position.x,e=Lite.myGame.cameraControl.mCamera.node.position.x+750,i=[],a=0;a<Lite.myGame.m_Array.length;a++)t<Lite.myGame.m_Array[a].children[1].position.x&&Lite.myGame.m_Array[a].children[1].position.x<e&&i.push(a);if(i.length>0){var o=Number(moosnow.Common.randomNumBoth(0,i.length-1)),s=new cc.Vec2(Lite.myGame.m_Array[i[o]].children[1].position.x,Lite.myGame.m_Array[i[o]].children[1].position.y),r=Lite.myGame.m_Array[i[o]].children[1].getComponent(m.default).masterNum,l=cc.moveTo(.1,s);this.node.stopAllActions(),this.node.runAction(l),moosnow.event.sendEventImmediately(n.default.MASTER_HIT,{masterNum:r,skillFlag:!0})}else this.playerState==c.PLAYER_STATE.E_State_Skill&&(this.node.setPosition(this.p_Skill_Pos),this.ani.active=!0,this.setPlayerState(c.PLAYER_STATE.E_State_Idle))},e.prototype.playerSkillDark=function(){var t=this.p_Skill_Range,e=this.node.position.x;this.ani.scaleX>0?e+=t:e-=t;for(var i=new cc.Vec3(e,this.node.position.y,this.node.position.z),a=0;a<Lite.myGame.m_Array.length;a++)if(l.default.getDistance(i,Lite.myGame.m_Array[a].children[1].position)<=t){var o=Lite.myGame.m_Array[a].children[1].getComponent(m.default).masterNum;moosnow.event.sendEventImmediately(n.default.MASTER_HIT,{masterNum:o,skillFlag:!0})}},e.prototype.playerSkillIce=function(){for(var t=this.p_Skill_Range,e=this.node.position,i=0;i<Lite.myGame.m_Array.length;i++){var a=Lite.myGame.m_Array[i].children[1].position;if(l.default.getDistance(e,a)<=t&&Math.abs(a.y-e.y)<=t/2){var o=Lite.myGame.m_Array[i].children[1].getComponent(m.default).masterNum;moosnow.event.sendEventImmediately(n.default.MASTER_HIT,{masterNum:o,skillFlag:!0})}}},e.prototype.playerSkillBlood=function(){for(var t=this.p_Skill_Range,e=this.node.position,i=0;i<Lite.myGame.m_Array.length;i++){var a=Lite.myGame.m_Array[i].children[1].position;if(l.default.getDistance(e,a)<=t&&Math.abs(a.y-e.y)<=t/2){var o=Lite.myGame.m_Array[i].children[1].getComponent(m.default).masterNum;moosnow.event.sendEventImmediately(n.default.MASTER_HIT,{masterNum:o,skillFlag:!0})}}},e.prototype.playerSkillPoison=function(){var t=this.p_Skill_Range,e=this.node.position.x;this.ani.scaleX>0?e+=t:e-=t;for(var i=new cc.Vec3(e,this.node.position.y,this.node.position.z),a=0;a<Lite.myGame.m_Array.length;a++){var o=Lite.myGame.m_Array[a].children[1].position;if(l.default.getDistance(i,o)<=t&&Math.abs(o.y-i.y)<=t/2){var s=Lite.myGame.m_Array[a].children[1].getComponent(m.default).masterNum;moosnow.event.sendEventImmediately(n.default.MASTER_HIT,{masterNum:s,skillFlag:!0})}}},e.prototype.setPlayerDirection=function(t){0==t?(this.ani.scaleX=1,this.p_Life_Progress.node.scaleX=1):(this.ani.scaleX=-1,this.p_Life_Progress.node.scaleX=-1)},e.prototype.updateAttackTime=function(){this.attackTimeFlag=!0,this.attackTime=this.attackTimeMax},e.prototype.attackMovePlayer=function(){this.ani.scaleX},e.prototype.autoSearchMaster=function(){if(this.p_Attack_Speed_Flag){for(var t=Lite.myGame.cameraControl.mCamera.node.position.x,e=Lite.myGame.cameraControl.mCamera.node.position.x+750,i=[],a=-1,o=0,s=!1,n=0;n<Lite.myGame.m_Array.length;n++)if(t<Lite.myGame.m_Array[n].children[1].position.x&&Lite.myGame.m_Array[n].children[1].position.x<e){var r=Lite.myGame.m_Array[n].children[1],m=l.default.getDistance(this.node.position,r.position);if(m<260&&Math.abs(this.node.position.y-r.position.y)<=30)if(this.ani.scaleX>0){if(this.node.position.x<r.position.x){s=!0;break}}else if(this.node.position.x>r.position.x){s=!0;break}m<400&&Math.abs(this.node.position.y-r.position.y)<=250&&(i.push(n),0==o?(o=m,a=i.length-1):o>m&&(o=m,a=i.length-1))}if(s)this.playerNormalAttack();else if(a>=0){var h=Lite.myGame.m_Array[i[a]].children[1],c=0;c=Math.abs(this.node.position.x-h.position.x)>200?200:Math.abs(this.node.position.x-h.position.x),h.position.x<this.node.position.x?(this.setPlayerDirection(1),c=h.position.x+c):(this.setPlayerDirection(0),c=h.position.x-c);var _=cc.callFunc(function(){this.p_Invincible=!1,this.updatezIndex(),Lite.myGame.cameraControl.movemCamera(c-375),this.playerNormalAttack()},this),p=new cc.Vec2(c,h.position.y),d=cc.moveTo(.1,p),y=cc.sequence(d,_);this.node.stopAllActions(),this.p_Invincible=!0,this.node.runAction(y)}else this.playerNormalAttack()}},e.prototype.playerNormalAttack=function(){Lite.myGame.player.setPlayerState(c.PLAYER_STATE.E_State_Attack),5==Lite.myGame.guidancePro&&(Lite.myGame.guidancePro=6,moosnow.event.sendEventImmediately(n.default.GUIDANCE_NOVICE,{}))},e.prototype.addListener=function(){moosnow.event.addListener(n.default.PLAYER_DEATH,this,this.playerDeath),moosnow.event.addListener(n.default.PLAYER_HIT,this,this.playerHit),moosnow.event.addListener(n.default.PLAYER_SKILL,this,this.playerSkill),moosnow.event.addListener(n.default.SHOW_LIANZHAN,this,this.updateAttackTime)},e.prototype.removeListener=function(){moosnow.event.removeListener(n.default.PLAYER_DEATH,this),moosnow.event.removeListener(n.default.PLAYER_HIT,this),moosnow.event.removeListener(n.default.PLAYER_SKILL,this),moosnow.event.removeListener(n.default.SHOW_LIANZHAN,this)},e.prototype.createHitNumPool=function(){this.hitnumPool=new cc.NodePool;for(var t=0;t<5;++t){var e=cc.instantiate(this.hitnumPrefab);this.hitnumPool.put(e)}},e.prototype.createHitNum=function(t){var e=null;(e=this.hitnumPool.size()>0?this.hitnumPool.get():cc.instantiate(this.hitnumPrefab)).parent=this.node.parent,e.getComponent("HitNumControl").init(t,this.node,null,0)},e.prototype.checkCritical=function(){return moosnow.Common.randomNumBoth(1,100)<=this.critical_Rate},e.prototype.attachmentChange=function(){this.ske_com_player.setSkin(this.weaponId.toString())},e.prototype.changePartialCloth=function(t,e,i,a){var o=t.findSlot(e),s=t.skeletonData.getRuntimeData(),n=s.findSkin(i),r=s.findSlotIndex(e),m=n.getAttachment(r,a);o&&m?(o.setAttachment(m),t.invalidAnimationCache()):cc.error(o&&m,"slots: "+e+", attach: "+a+" not exists!")},e.prototype.changeAniColorForAttachment=function(t){t!=p.WEAPON.W_Iron&&(t==p.WEAPON.W_ICE?new cc.color(27,162,172,1):t==p.WEAPON.W_Poison?new cc.color(14,159,34,1):t==p.WEAPON.W_Blood?new cc.color(255,0,0,1):t==p.WEAPON.W_Dark?new cc.color(0,0,0,1):t==p.WEAPON.W_Light&&new cc.color(255,255,100,1))},e.prototype.changeAniColor=function(t){if(1!=t){var e=null;t==p.WEAPON.W_ICE?e=new cc.color(27,162,172,255):t==p.WEAPON.W_Poison?e=new cc.color(14,159,34,255):t==p.WEAPON.W_Blood?e=new cc.color(255,0,0,255):t==p.WEAPON.W_Dark?e=new cc.color(0,0,0,255):t==p.WEAPON.W_Light&&(e=new cc.color(255,255,100,255)),moosnow.event.sendEventImmediately(n.default.PLAYER_ANIM_COLOR_CHANGE,{color:e})}},e.prototype.onDisable=function(){this.removeListener()},e.prototype.update=function(t){this.playerState,c.PLAYER_STATE.E_State_Death,this.ani.scaleX<0?this.shader.setPosition(0-this.bone.x+8,this.ani.y+5):this.shader.setPosition(this.bone.x-8,this.ani.y+5),this.hitFixedTime>0?this.hitFixedTime-=t:this.playerState==c.PLAYER_STATE.E_State_Hit&&this.setPlayerState(c.PLAYER_STATE.E_State_Idle),this.attackTimeFlag&&(this.attackTime<=0?(this.attackTimeFlag=!1,this.attackState=0,this.aniCompleteFlag=!0,moosnow.event.sendEventImmediately(n.default.END_SHOW_LIANZHAN,{})):this.attackTime-=t),this.p_Attack_Speed>0?this.p_Attack_Speed-=t:this.p_Attack_Speed_Flag=!0},s([S(cc.ProgressBar)],e.prototype,"p_Life_Progress",void 0),s([S(cc.Node)],e.prototype,"aniFrameHit",void 0),s([S(cc.Node)],e.prototype,"aniFrameSkill",void 0),s([S(cc.Node)],e.prototype,"aniFrameSkill_5",void 0),s([S(cc.Node)],e.prototype,"aniFrameSkill_4",void 0),s([S(cc.Node)],e.prototype,"aniFrameSkill_2",void 0),s([S(cc.Node)],e.prototype,"aniFrameSkill_3",void 0),s([S(cc.Node)],e.prototype,"shader",void 0),s([S(cc.Prefab)],e.prototype,"hitnumPrefab",void 0),s([S(cc.Label)],e.prototype,"txtHp",void 0),s([A],e)}(r.default);i.default=E,cc._RF.pop()},{"../../../script/entity/BaseControl":void 0,"../../../script/enum/MASTER_TYPE":void 0,"../../../script/enum/PLAYER_SPINE":void 0,"../../../script/enum/PLAYER_STATE":void 0,"../../../script/enum/WEAPON":void 0,"../../../script/framework/utils/FrameworkEvent":void 0,"../../../script/framework/utils/MathUtils":void 0,"../../../sheets/vo/PlayerUpgrade":void 0,"../../../sheets/vo/WeaponCfg":void 0,"./MasterControl":"MasterControl"}],buffForm:[function(t,e,i){"use strict";cc._RF.push(e,"211ddygO2ZKRrvr86NTmJNp","buffForm");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../script/framework/ui/buffBase"),r=cc._decorator,m=r.ccclass,l=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isMask=!1,e}return o(e,t),e.prototype.onShow=function(e){t.prototype.onShow.call(this,e)},e.prototype.onHide=function(e){t.prototype.onHide.call(this,e)},e.prototype.onContinue=function(){},e.prototype.onReplay=function(){},s([m],e)}(n.default));i.default=l,cc._RF.pop()},{"../../script/framework/ui/buffBase":void 0}],gameForm:[function(t,e,i){"use strict";cc._RF.push(e,"80c9e8u/0pDAbZ4b7EeXxIT","gameForm");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../script/framework/ui/gameBase"),r=cc._decorator,m=r.ccclass,l=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.loadLevel=function(){},e.prototype.addListener=function(){t.prototype.addListener.call(this)},e.prototype.removeListener=function(){t.prototype.removeListener.call(this)},e.prototype.onShow=function(e){t.prototype.onShow.call(this,e)},e.prototype.onHide=function(e){t.prototype.onShow.call(this,e)},s([m],e)}(n.default));i.default=l,cc._RF.pop()},{"../../script/framework/ui/gameBase":void 0}],pauseForm:[function(t,e,i){"use strict";cc._RF.push(e,"b6082XV+1pIN7igzpJpnF+F","pauseForm");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../script/config/UIForms"),r=t("../../script/framework/AD_POSITION"),m=t("../../script/framework/ui/pauseBase"),l=cc._decorator,h=l.ccclass,c=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isMask=!0,e}return o(e,t),e.prototype.onShow=function(e){t.prototype.onShow.call(this,e),moosnow.platform.showBanner(!1,null,moosnow.BANNER_HORIZONTAL.CENTER,moosnow.BANNER_VERTICAL.BOTTOM),moosnow.form.hideAd(null)},e.prototype.onHide=function(e){t.prototype.onHide.call(this,e),moosnow.platform.hideBanner(),moosnow.form.showAd(r.AD_POSITION.RECOVER,null)},e.prototype.onContinue=function(){this.openNative(function(){Lite.ui.hideUIForm(n.default.PauseForm,null)})},e.prototype.onReplay=function(){this.openNative(function(){})},e.prototype.onBackHome=function(){this.openNative(function(){Lite.ui.hideUIForm(n.default.PauseForm,null)})},s([h],e)}(m.default));i.default=c,cc._RF.pop()},{"../../script/config/UIForms":void 0,"../../script/framework/AD_POSITION":void 0,"../../script/framework/ui/pauseBase":void 0}],playAni:[function(t,e,i){"use strict";cc._RF.push(e,"d2740qWTwlBVZ42lLU62uoN","playAni");var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,a){var o,s=arguments.length,n=s<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../script/framework/utils/FrameworkEvent"),r=cc._decorator,m=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.audio=null,e.anim=null,e}return o(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.addListener()},e.prototype.playAudio=function(){},e.prototype.playAnim=function(t){t.aniName==this.node.name&&this.anim.play()},e.prototype.colorChange=function(t){this.node.color=t.color},e.prototype.addListener=function(){moosnow.event.addListener(n.default.PLAYER_ANIM,this,this.playAnim),moosnow.event.addListener(n.default.PLAYER_ANIM_COLOR_CHANGE,this,this.colorChange)},e.prototype.removeListener=function(){moosnow.event.removeListener(n.default.PLAYER_ANIM,this),moosnow.event.removeListener(n.default.PLAYER_ANIM_COLOR_CHANGE,this)},e.prototype.onDestroy=function(){this.removeListener()},e.prototype.update=function(){},s([l(cc.AudioClip)],e.prototype,"audio",void 0),s([m],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../../../script/framework/utils/FrameworkEvent":void 0}]},{},["buffForm","gameForm","pauseForm","CoinControl","ColliderListener","GuidanceControl","HitNumControl","JoyStick","MasterControl","PlayerControl","playAni"]);